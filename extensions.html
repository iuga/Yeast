<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Custom Steps - Yeast</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="A Python data processing engine for modeling or visualization">
<meta name="generator" content="mkdocs-1.1, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="./css/style.min.css" rel="stylesheet">
<link href="extra.css" rel="stylesheet">
<link href="styles.css" rel="stylesheet"> 
</head>

<body>
<div class="book without-summary">
<div class="book-summary">

<nav role="navigation">
<ul class="summary">
<!--
<li>
<a href="." target="_blank" class="custom-link">Yeast</a>
</li>
<li class="divider"></li> -->
<li class="header">Yeast</li>

<li>
<a href="index.html" class="">Home</a>
</li>

<li class="header">Getting Started</li>

<li>
<a href="introduction.html" class="">5 Minute Introduction</a>
</li>

<li>
<a href="selectors.html" class="">Methods for Selecting Variables</a>
</li>

<li>
<a href="transformers.html" class="">Methods for Transforming Variables</a>
</li>

<li>
<a href="aggregations.html" class="">Methods for Groups and Aggregations</a>
</li>

<li>
<a href="merge.html" class="">Join two DataFrames together</a>
</li>

<li class="header">Developers API</li>

<li>
<a href="reference.html" class="">Step Reference</a>
</li>

<li>
<a href="extensions.html" class="active">Custom Steps</a>
</li>

<li>
<a href="roadmap.html" class="">Roadmap</a>
</li>

<li class="header">Examples</li>

<li>
<a href="examples/san_francisco_crime.html" class="">San Francisco Crime</a>
</li>

<!-- <li class="divider"></li> -->



</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">

<section class="normal markdown-section">



<h1 id="custom-steps">Custom Steps<a class="headerlink" href="#custom-steps" title="Permanent link">&para;</a></h1>
<p>The Yeast library contains a number of different Steps but you might need to define your own
operations using <code>CustomStep</code>:</p>
<div class="autodoc">
<div class="autodoc-signature"><em>class </em><code>yeast.steps.<strong>CustomStep</strong></code><span class="autodoc-punctuation">(</span><em class="autodoc-param">to_prepare=None</em><span class="autodoc-punctuation">, </span><em class="autodoc-param">to_bake=None</em><span class="autodoc-punctuation">, </span><em class="autodoc-param">to_validate=None</em><span class="autodoc-punctuation">)</span></div>
<div class="autodoc-docstring"><p>Custom Step was designed to extend all the power of Yeast Pipelines and cover all scenarios
where the Yeast steps are not adequate. You might need to define your own operations.
You could define your custom transformations, business rules or extend to third-party libraries.
The usage is quite straightforward and designed to avoid spending too much time on the
implementation. It expects between 1 and 3 arguments, all functions and optional:</p>
<ul>
<li><code>to_validate(step, df)</code></li>
<li><code>to_prepare(step, df)</code>: returns <code>df</code></li>
<li><code>to_bake(step, df)</code>: returns <code>df</code></li>
</ul>
<p>Please notice that <code>to_prepare</code> and <code>to_bake</code> must return a <code>DataFrame</code> to continue the pipeline
execution in further steps. <code>CustomStep</code> enables you to structure and document your code and
business rules in Steps that could be shared across Recipes.</p>
<p>Parameters:</p>
<ul>
<li><code>to_validate</code>: perform validations on the data. Raise YeastValidationError on a problem.</li>
<li><code>to_prepare</code>: prepare the step before bake, like train or calculate aggregations.</li>
<li><code>to_bake</code>: execute the bake (processing). This is the core method.</li>
</ul>
<p>Inline Usage:</p>
<div class="codehilite"><pre><span></span><code><span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">([</span>
    <span class="c1"># Custom Business Rules:</span>
    <span class="n">CustomStep</span><span class="p">(</span><span class="n">to_bake</span><span class="o">=</span><span class="k">lambda</span> <span class="n">step</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="p">])</span>
</code></pre></div>


<p>Custom rules:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">my_bake</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="c1"># Calculate total sales or anything you need:</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;total_sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fees&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">([</span>
    <span class="c1"># Custom Business Rules:</span>
    <span class="n">CustomStep</span><span class="p">(</span><span class="n">to_bake</span><span class="o">=</span><span class="n">my_bake</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>


<p>Custom Checks and Validations:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">my_validate</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;sales&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YeastValidationError</span><span class="p">(</span><span class="s1">&#39;sales column not found&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;fees&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">YeastValidationError</span><span class="p">(</span><span class="s1">&#39;fees colum not found&#39;</span><span class="p">)</span>

<span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">([</span>
    <span class="n">CustomStep</span><span class="p">(</span><span class="n">to_validate</span><span class="o">=</span><span class="n">my_validate</span><span class="p">,</span> <span class="n">to_bake</span><span class="o">=</span><span class="n">my_bake</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>


<p>Define the Estimation/Preparation procedure:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">my_preparation</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="n">step</span><span class="o">.</span><span class="n">mean_sales</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">my_bake</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales_deviation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span><span class="o">.</span><span class="n">mean_sales</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">([</span>
    <span class="n">CustomStep</span><span class="p">(</span><span class="n">to_prepare</span><span class="o">=</span><span class="n">my_preparation</span><span class="p">,</span> <span class="n">to_bake</span><span class="o">=</span><span class="n">my_bake</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div>


<p>Creating a custom step inheriting from CustomStep:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MyCustomStep</span><span class="p">(</span><span class="n">CustomStep</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">do_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># Some validations that could raise YeastValidationError</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">do_prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># Prepare the step if needed</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">do_bake</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># Logic to process the df</span>
        <span class="k">return</span> <span class="n">df</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="p">([</span>
    <span class="n">MyCustomStep</span><span class="p">()</span>
<span class="p">])</span>
</code></pre></div>


<p>Raises:</p>
<ul>
<li><code>YeastValidationError</code>: if any of the parameters is defined but not callable.</li>
</ul></div>
</div>


</section>

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="./js/main.js"></script>
<script src="./js/gitbook.min.js"></script>
<script src="./js/theme.min.js"></script>
</body>
</html>